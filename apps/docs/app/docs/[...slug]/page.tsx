import type { Metadata } from 'next';
import {
  DocsPage,
  DocsBody,
  DocsTitle,
  DocsDescription,
  DocsCategory,
} from 'fumadocs-ui/page';
import { notFound } from 'next/navigation';
import { Fragment } from 'react';
import { cva } from 'class-variance-authority';
import { utils } from '@/utils/source';
import { createMetadata } from '@/utils/metadata';
import Preview from '@/components/preview';
import { cn } from '@/utils/cn';

interface Param {
  slug: string[];
}

const sponsors = [
  {
    url: 'https://unkey.com',
    label: 'Unkey',
    logo: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 93 40"
        className="h-full"
      >
        <path
          d="M10.8 30.3C4.8 30.3 1.38 27.12 1.38 21.66V9.9H4.59V21.45C4.59 25.5 6.39 27.18 10.8 27.18C15.21 27.18 17.01 25.5 17.01 21.45V9.9H20.25V21.66C20.25 27.12 16.83 30.3 10.8 30.3ZM26.3611 30H23.1211V15.09H26.0911V19.71H26.3011C26.7511 17.19 28.7311 14.79 32.5111 14.79C36.6511 14.79 38.6911 17.58 38.6911 21.03V30H35.4511V21.9C35.4511 19.11 34.1911 17.7 31.1011 17.7C27.8311 17.7 26.3611 19.38 26.3611 22.62V30ZM44.8181 30H41.5781V9.9H44.8181V21H49.0781L53.5481 15.09H57.3281L51.7181 22.26L57.2981 30H53.4881L49.0781 23.91H44.8181V30ZM66.4219 30.3C61.5319 30.3 58.3219 27.54 58.3219 22.56C58.3219 17.91 61.5019 14.79 66.3619 14.79C70.9819 14.79 74.1319 17.34 74.1319 21.87C74.1319 22.41 74.1019 22.83 74.0119 23.28H61.3519C61.4719 26.16 62.8819 27.69 66.3319 27.69C69.4519 27.69 70.7419 26.67 70.7419 24.9V24.66H73.9819V24.93C73.9819 28.11 70.8619 30.3 66.4219 30.3ZM66.3019 17.34C63.0019 17.34 61.5619 18.81 61.3819 21.48H71.0719V21.42C71.0719 18.66 69.4819 17.34 66.3019 17.34ZM78.9586 35.1H76.8286V32.16H79.7386C81.0586 32.16 81.5986 31.8 82.0486 30.78L82.4086 30L75.0586 15.09H78.6886L82.4986 23.01L83.9686 26.58H84.2086L85.6186 22.98L89.1286 15.09H92.6986L84.9286 31.62C83.6986 34.29 82.0186 35.1 78.9586 35.1Z"
          fill="currentColor"
        />
      </svg>
    ),
  },
  {
    url: 'https://github.com/scalar/scalar',
    label: 'Scalar',
    logo: (
      <>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 593 593"
          className="h-full"
        >
          <path
            fill="currentColor"
            fillRule="evenodd"
            d="M347 0c6 0 12 5 12 12v134l94-95c5-5 13-5 17 0l72 72c4 4 5 12 0 16v1l-95 94h134c7 0 12 5 12 12v101c0 7-5 12-12 12H447l95 94c4 5 5 13 0 17l-72 72c-4 4-12 5-16 0h-1l-94-95v134c0 7-5 12-12 12H246c-7 0-12-5-12-12v-70c0-22 9-43 24-59l130-130c14-14 14-37 0-51L259 142a84 84 0 0 1-25-59V12c0-7 5-12 12-12zM138 52h1l219 219c14 14 14 37 0 51L139 542c-4 5-12 5-17 0l-71-70c-4-5-5-12 0-17l95-96H12c-7 0-12-5-12-12V246c0-7 5-12 12-12h134l-95-94c-4-5-4-12 0-17l71-71c4-5 12-5 16 0"
          />
        </svg>
        Scalar
      </>
    ),
  },
  {
    url: 'https://supastarter.dev',
    logo: (
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 419 184"
        className="h-full"
      >
        <path
          d="M74.878 129.813L53.8042 177.336M79.929 164.698L74.546 176.813M43.5838 148.549L38.2008 160.664M50.7614 132.396L36.6272 126.115M36.6272 126.115C36.6272 126.115 6.22941 131.951 6.00437 127.016C5.77932 122.08 14.3028 102.898 19.4621 96.728C24.6215 90.558 55.4681 83.7126 55.4681 83.7126M36.6272 126.115L55.4681 83.7126M55.4681 83.7126C55.4681 83.7126 77.1698 46.2078 92.4795 27.6233C107.789 9.03868 121.759 3.84198 128.322 6.75779C134.884 9.6736 140.433 23.5432 136.901 47.3613C133.37 71.1795 120.082 112.423 120.082 112.423M87.1066 148.545L101.241 154.825M101.241 154.825C101.241 154.825 117.284 181.296 121.097 178.155C124.911 175.014 133.434 155.832 134.555 147.867C135.676 139.903 120.082 112.423 120.082 112.423M101.241 154.825L120.082 112.423M108.357 83.0346C105.632 89.168 98.4503 91.9308 92.3169 89.2056C86.1835 86.4803 83.4207 79.299 86.146 73.1656C88.8712 67.0322 96.0526 64.2694 102.186 66.9946C108.319 69.7199 111.082 76.9012 108.357 83.0346Z"
          stroke="currentColor"
          strokeWidth="11.0476"
          strokeLinecap="round"
        />
        <path
          fillRule="evenodd"
          clipRule="evenodd"
          d="M178.574 75.5777C181.605 77.7046 185.529 78.7681 190.345 78.7681C195.357 78.7681 199.281 77.6557 202.117 75.431C204.977 73.2063 206.407 70.1382 206.407 66.2266C206.407 64.1975 205.979 62.474 205.124 61.0561C204.292 59.6137 202.899 58.3791 200.943 57.3523C198.987 56.3011 196.347 55.3476 193.022 54.492C189.917 53.7097 187.571 53.0374 185.981 52.4751C184.392 51.9128 183.317 51.3261 182.754 50.7149C182.217 50.1037 181.948 49.3581 181.948 48.478C181.948 46.9622 182.669 45.7765 184.111 44.9209C185.554 44.0408 187.436 43.6496 189.759 43.7474C192.179 43.8452 194.147 44.4442 195.663 45.5443C197.178 46.6444 198.071 48.1479 198.34 50.0548L206.187 48.6246C205.894 46.2777 205.014 44.2364 203.547 42.5006C202.08 40.7404 200.161 39.3836 197.789 38.4302C195.418 37.4767 192.717 37 189.685 37C186.58 37 183.867 37.4889 181.544 38.4668C179.246 39.4447 177.462 40.826 176.19 42.6106C174.919 44.3953 174.283 46.4855 174.283 48.8813C174.283 50.8127 174.699 52.4629 175.53 53.8319C176.386 55.1765 177.804 56.3622 179.784 57.389C181.789 58.3913 184.49 59.3325 187.888 60.2126C190.993 61.0438 193.303 61.7406 194.819 62.3029C196.335 62.8652 197.325 63.4641 197.789 64.0997C198.278 64.7109 198.523 65.5177 198.523 66.52C198.523 68.2313 197.838 69.5759 196.469 70.5538C195.125 71.5317 193.255 72.0206 190.859 72.0206C188.218 72.0206 186.006 71.4339 184.221 70.2604C182.461 69.0625 181.337 67.4368 180.848 65.3832L173 66.5934C173.685 70.456 175.543 73.4508 178.574 75.5777ZM220.352 77.4479C222.21 78.328 224.508 78.7681 227.246 78.7681C230.815 78.7681 233.859 77.998 236.377 76.4578C237.916 75.5162 239.237 74.3507 240.337 72.9614V77.7046H247.158V38.1001H239.421V58.7091C239.421 61.0561 239.152 63.0485 238.614 64.6865C238.1 66.3244 237.379 67.6446 236.45 68.6469C235.546 69.6493 234.482 70.3827 233.26 70.8472C232.038 71.2872 230.742 71.5072 229.373 71.5072C227.27 71.5072 225.559 71.0794 224.239 70.2238C222.943 69.3681 221.929 68.2435 221.195 66.85C220.486 65.4566 219.997 63.9531 219.728 62.3395C219.484 60.7016 219.362 59.1125 219.362 57.5723V38.1001H211.587V60.1026C211.587 61.325 211.697 62.7429 211.917 64.3564C212.138 65.9699 212.553 67.6201 213.164 69.307C213.775 70.9939 214.656 72.5585 215.805 74.0009C216.978 75.4188 218.494 76.5678 220.352 77.4479ZM273.835 78.8047C270.046 78.8047 266.868 77.888 264.301 76.0544C263.814 75.702 263.349 75.3262 262.907 74.9272V95.3066H255.206V38.1001H262.027V41.6389C262.701 40.944 263.434 40.3145 264.227 39.7503C266.794 37.9168 269.948 37 273.688 37C277.404 37 280.607 37.9168 283.296 39.7503C286.01 41.5594 288.1 44.0408 289.567 47.1945C291.034 50.3237 291.767 53.8808 291.767 57.8657C291.767 61.8261 291.034 65.3954 289.567 68.5736C288.124 71.7273 286.059 74.2209 283.369 76.0544C280.705 77.888 277.527 78.8047 273.835 78.8047ZM263.127 50.6049C262.394 52.7073 262.027 55.1276 262.027 57.8657C262.027 60.6038 262.394 63.0241 263.127 65.1265C263.861 67.229 265.022 68.8792 266.611 70.0771C268.2 71.275 270.254 71.874 272.772 71.874C275.216 71.874 277.233 71.2505 278.822 70.0037C280.436 68.7569 281.634 67.0823 282.416 64.9798C283.223 62.8529 283.626 60.4815 283.626 57.8657C283.626 55.2743 283.223 52.9274 282.416 50.8249C281.634 48.7224 280.424 47.0478 278.786 45.801C277.148 44.5542 275.057 43.9308 272.515 43.9308C270.119 43.9308 268.139 44.5175 266.574 45.691C265.034 46.8644 263.885 48.5024 263.127 50.6049ZM301.477 77.1912C303.458 78.2669 305.915 78.8047 308.848 78.8047C312.54 78.8047 315.645 78.0713 318.163 76.6045C320.066 75.4879 321.717 73.9395 323.113 71.9593V77.7046H329.897V53.3185C329.897 51.6561 329.824 50.1037 329.677 48.6613C329.531 47.2189 329.139 45.8499 328.504 44.5542C327.281 41.9383 325.35 40.0315 322.71 38.8335C320.094 37.6112 317.014 37 313.469 37C308.897 37 305.23 38.0023 302.467 40.007C299.729 42.0117 297.871 44.7131 296.894 48.1113L304.044 50.3115C304.729 48.0868 305.939 46.4977 307.675 45.5443C309.411 44.5664 311.317 44.0775 313.395 44.0775C316.696 44.0775 319.018 44.8353 320.363 46.3511C321.558 47.6527 322.213 49.5689 322.327 52.0998C320.826 52.3105 319.316 52.5211 317.796 52.7318C315.351 53.074 313.016 53.4408 310.792 53.8319C308.567 54.2231 306.575 54.6753 304.814 55.1887C302.785 55.8488 301.074 56.7167 299.681 57.7924C298.287 58.8436 297.236 60.1271 296.527 61.6428C295.818 63.1585 295.463 64.9187 295.463 66.9234C295.463 69.0747 295.965 71.055 296.967 72.8641C297.994 74.6487 299.497 76.0911 301.477 77.1912ZM315.816 71.3972C314.251 72.1551 312.381 72.534 310.205 72.534C308.567 72.534 307.222 72.2773 306.171 71.7639C305.12 71.2505 304.338 70.566 303.824 69.7104C303.311 68.8303 303.054 67.8768 303.054 66.85C303.054 65.7988 303.286 64.9065 303.751 64.1731C304.24 63.4397 304.888 62.8163 305.695 62.3029C306.526 61.7895 307.467 61.3494 308.518 60.9827C309.765 60.5916 311.183 60.2615 312.772 59.9926C314.386 59.6992 316.182 59.4059 318.163 59.1125C319.434 58.9241 320.796 58.7206 322.249 58.502C322.231 59.1479 322.202 59.8892 322.16 60.726C322.111 62.1929 321.879 63.513 321.463 64.6865C321.17 65.9822 320.546 67.229 319.593 68.4269C318.639 69.6248 317.38 70.6149 315.816 71.3972ZM240.956 145.162C238.138 145.688 235.374 145.912 232.662 145.833C229.977 145.78 227.568 145.293 225.435 144.372C223.303 143.424 221.684 141.936 220.578 139.909C219.604 138.066 219.09 136.184 219.038 134.262C218.985 132.34 218.959 130.168 218.959 127.746V109.975H211.218V102.511H218.959V90.6631H228.437V102.511H240.956V109.975H228.437V127.193C228.437 128.904 228.45 130.405 228.476 131.695C228.529 132.985 228.805 134.038 229.305 134.854C230.253 136.434 231.767 137.316 233.847 137.5C235.927 137.684 238.296 137.579 240.956 137.184V145.162ZM192.064 146.346C186.798 146.346 182.52 145.162 179.229 142.792C175.938 140.423 173.937 137.092 173.226 132.801L182.941 131.3C183.441 133.406 184.547 135.065 186.258 136.276C187.97 137.487 190.129 138.093 192.735 138.093C195.025 138.093 196.789 137.645 198.027 136.75C199.291 135.828 199.922 134.578 199.922 132.998C199.922 132.024 199.685 131.247 199.212 130.668C198.764 130.063 197.764 129.483 196.21 128.931C194.657 128.378 192.274 127.68 189.062 126.837C185.482 125.89 182.638 124.876 180.532 123.797C178.426 122.691 176.912 121.388 175.99 119.887C175.069 118.386 174.608 116.57 174.608 114.437C174.608 111.778 175.306 109.461 176.701 107.487C178.097 105.512 180.045 103.998 182.546 102.945C185.047 101.866 187.996 101.326 191.392 101.326C194.71 101.326 197.645 101.839 200.199 102.866C202.779 103.893 204.859 105.354 206.439 107.25C208.018 109.145 208.992 111.37 209.361 113.924L199.646 115.661C199.409 113.845 198.58 112.41 197.158 111.357C195.763 110.304 193.893 109.711 191.55 109.58C189.312 109.448 187.509 109.79 186.14 110.606C184.771 111.396 184.086 112.515 184.086 113.963C184.086 114.779 184.363 115.477 184.916 116.056C185.468 116.635 186.574 117.215 188.233 117.794C189.918 118.373 192.419 119.084 195.736 119.926C199.133 120.795 201.844 121.796 203.872 122.928C205.925 124.034 207.4 125.363 208.295 126.916C209.216 128.47 209.677 130.352 209.677 132.564C209.677 136.855 208.11 140.225 204.977 142.674C201.871 145.122 197.566 146.346 192.064 146.346ZM251.864 144.609C253.997 145.767 256.603 146.346 259.684 146.346C263.528 146.346 266.726 145.635 269.28 144.214C271.265 143.1 273.056 141.502 274.651 139.422V145.162H282.984V118.979C282.984 117.136 282.905 115.438 282.747 113.884C282.589 112.305 282.128 110.764 281.365 109.264C279.969 106.447 277.824 104.419 274.928 103.182C272.058 101.945 268.727 101.326 264.936 101.326C259.908 101.326 255.906 102.418 252.931 104.604C249.982 106.789 247.981 109.685 246.928 113.292L255.616 116.017C256.327 113.832 257.578 112.291 259.368 111.396C261.158 110.501 263.014 110.053 264.936 110.053C268.122 110.053 270.386 110.751 271.729 112.147C272.847 113.308 273.49 115.008 273.659 117.246C271.932 117.504 270.249 117.752 268.609 117.991C265.923 118.36 263.422 118.768 261.105 119.216C258.815 119.663 256.814 120.163 255.103 120.716C252.839 121.48 250.996 122.467 249.574 123.678C248.152 124.863 247.099 126.285 246.415 127.943C245.73 129.576 245.388 131.418 245.388 133.472C245.388 135.815 245.928 137.961 247.007 139.909C248.113 141.857 249.732 143.424 251.864 144.609ZM267.108 137.619C265.581 138.382 263.738 138.764 261.579 138.764C260.079 138.764 258.815 138.527 257.788 138.053C256.788 137.579 256.024 136.947 255.498 136.157C254.971 135.341 254.708 134.407 254.708 133.354C254.708 132.432 254.905 131.629 255.3 130.945C255.721 130.26 256.314 129.655 257.077 129.128C257.841 128.601 258.775 128.141 259.881 127.746C261.013 127.377 262.317 127.048 263.791 126.758C265.265 126.443 267.029 126.113 269.083 125.771C270.397 125.552 271.878 125.312 273.526 125.05C273.507 125.775 273.474 126.608 273.427 127.548C273.374 129.102 273.098 130.484 272.598 131.695C272.282 132.669 271.663 133.709 270.741 134.815C269.846 135.921 268.635 136.855 267.108 137.619ZM290.896 145.162V102.511H299.308V109.323C299.628 108.75 299.984 108.204 300.374 107.684C301.269 106.499 302.335 105.525 303.573 104.762C304.626 104.051 305.784 103.498 307.048 103.103C308.338 102.682 309.747 102.59 311.09 102.511H315.334H323.075V90.6631H332.553V102.511H345.072V109.975H332.553V127.193C332.553 128.904 332.566 130.405 332.592 131.695C332.645 132.985 332.921 134.038 333.422 134.854C334.369 136.434 335.883 137.316 337.963 137.5C340.043 137.684 342.412 137.579 345.072 137.184V145.162C342.254 145.688 339.49 145.912 336.778 145.833C334.093 145.78 331.684 145.293 329.551 144.372C327.419 143.424 325.8 141.936 324.694 139.909C323.72 138.066 323.206 136.184 323.154 134.262C323.101 132.34 323.075 130.168 323.075 127.746V109.975H315.334C314.47 109.975 313.789 109.966 313.223 109.96C311.604 109.94 310.921 109.932 309.573 110.157C307.905 110.435 307.001 110.927 305.928 111.512C305.83 111.565 305.731 111.619 305.63 111.673C304.417 112.328 303.811 112.887 302.597 115.01C301.609 116.74 301.463 117.316 301.229 118.239L301.229 118.24C301.176 118.449 301.118 118.676 301.045 118.939C300.65 120.334 300.453 121.848 300.453 123.481V145.162H290.896ZM369.104 146.346C364.786 146.346 360.995 145.412 357.73 143.542C354.466 141.673 351.912 139.08 350.069 135.763C348.252 132.445 347.344 128.628 347.344 124.31C347.344 119.65 348.239 115.609 350.03 112.186C351.82 108.737 354.308 106.065 357.494 104.169C360.679 102.274 364.365 101.326 368.551 101.326C372.974 101.326 376.726 102.366 379.806 104.446C382.913 106.499 385.217 109.408 386.717 113.173C388.218 116.938 388.784 121.374 388.415 126.482H383.755H378.977H357.546C357.865 129.544 358.769 132.006 360.258 133.867C362.154 136.236 364.918 137.421 368.551 137.421C370.894 137.421 372.908 136.908 374.593 135.881C376.305 134.828 377.621 133.314 378.543 131.34L387.942 134.183C386.309 138.027 383.782 141.015 380.359 143.148C376.963 145.28 373.211 146.346 369.104 146.346ZM376.529 112.857C377.669 114.372 378.411 116.518 378.755 119.295H357.778C358.214 116.832 359.04 114.831 360.258 113.292C362.154 110.87 365.05 109.659 368.946 109.659C372.395 109.659 374.923 110.725 376.529 112.857ZM394.858 102.511V145.162H404.415V123.481C404.415 121.848 404.612 120.334 405.007 118.939C405.402 117.517 406.007 116.254 406.824 115.148C407.666 114.042 408.745 113.134 410.062 112.423C411.378 111.633 412.853 111.172 414.485 111.041C416.144 110.909 417.605 111.028 418.869 111.396V102.511C417.605 102.3 416.302 102.247 414.959 102.353C413.616 102.432 412.3 102.682 411.01 103.103C409.746 103.498 408.588 104.051 407.534 104.762C406.297 105.525 405.231 106.499 404.336 107.684C403.946 108.204 403.59 108.75 403.269 109.323V102.511H394.858Z"
          fill="currentColor"
        />
      </svg>
    ),
    label: 'supastarter',
  },
];

const sponsorVariants = cva(
  'inline-flex h-12 items-center justify-center gap-2 rounded-md bg-fd-muted p-2 text-fd-muted-foreground transition-colors hover:bg-fd-accent hover:text-fd-accent-foreground',
);

export default function Page({
  params,
}: {
  params: Param;
}): React.ReactElement {
  const page = utils.getPage(params.slug);

  if (!page) notFound();

  const path = `apps/docs/content/docs/${page.file.path}`;
  const preview = page.data.preview;

  return (
    <DocsPage
      toc={page.data.exports.toc}
      lastUpdate={page.data.exports.lastModified}
      full={page.data.full}
      tableOfContent={{
        style: 'clerk',
        single: false,
        footer: (
          <div className="grid grid-cols-2 gap-1">
            {sponsors.map((sponsor) => (
              <a
                key={sponsor.label}
                href={sponsor.url}
                aria-label={sponsor.label}
                rel="noreferrer noopener"
                target="_blank"
                className={cn(sponsorVariants())}
              >
                {sponsor.logo}
              </a>
            ))}
            <a
              // I'm greedy ;)
              href="https://github.com/sponsors/fuma-nama"
              rel="noreferrer noopener"
              target="_blank"
              className={cn(
                sponsorVariants({ className: 'text-xs text-center' }),
              )}
            >
              Become a sponsor
            </a>
          </div>
        ),
      }}
      editOnGithub={{
        repo: 'fumadocs',
        owner: 'fuma-nama',
        sha: 'main',
        path,
      }}
    >
      <DocsTitle>{page.data.title}</DocsTitle>
      <DocsDescription>{page.data.description}</DocsDescription>
      <DocsBody>
        {preview && preview in Preview ? Preview[preview] : null}
        <page.data.exports.default
          components={{
            HeadlessOnly:
              params.slug[0] === 'headless' ? Fragment : () => undefined,
            UIOnly: params.slug[0] === 'ui' ? Fragment : () => undefined,
          }}
        />
        {page.data.index ? (
          <DocsCategory page={page} pages={utils.getPages()} />
        ) : null}
      </DocsBody>
    </DocsPage>
  );
}

export function generateMetadata({ params }: { params: Param }): Metadata {
  const page = utils.getPage(params.slug);

  if (!page) notFound();

  const description =
    page.data.description ?? 'The library for building documentation sites';

  const image = {
    alt: 'Banner',
    url: `/og/docs/${page.slugs.join('/')}.png`,
    width: 1200,
    height: 630,
  };

  return createMetadata({
    title: page.data.title,
    description,
    openGraph: {
      url: `/docs/${page.slugs.join('/')}`,
      images: image,
    },
    twitter: {
      images: image,
    },
  });
}

export function generateStaticParams(): Param[] {
  return utils.getPages().map((page) => ({
    slug: page.slugs,
  }));
}
